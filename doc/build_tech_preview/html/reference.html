
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Reference &#8212; socok8s  documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Glossary" href="glossary.html" />
    <link rel="prev" title="Developer Documentation" href="contributor.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="contributor.html" title="Previous document">Developer Documentation</a>
        </li>
        <li>
          <a href="glossary.html" title="Next document">Glossary</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <div class="section" id="reference">
<span id="id1"></span><h1>Reference<a class="headerlink" href="#reference" title="Permalink to this headline">¶</a></h1>
<p>This chapter contains all the extra reference information (i.e. in more
details) about the socok8s repository.</p>
<p>For information on how to deploy socok8s, refer to <a class="reference internal" href="deployment/index.html#deploymentguide"><span class="std std-ref">Deployment Guide</span></a>.</p>
<p>For information on how to manage and operate socok8s, refer to
<a class="reference internal" href="operations.html#operationsdocumentation"><span class="std std-ref">Administration and Operations Guide</span></a>.</p>
<p>For information on how to contribute to socok8s, refer to
<a class="reference internal" href="contributor.html#developerdocumentation"><span class="std std-ref">Developer Documentation</span></a>.</p>
<div class="section" id="project-history">
<span id="projecthistory"></span><h2>Project history<a class="headerlink" href="#project-history" title="Permalink to this headline">¶</a></h2>
<p>This project started as a way to build and test the OpenStack-Helm charts for
SUSE, on our SUSE products: The Container as a Service Platform (CaaSP), and
the SUSE Enterprise Storage (SES).</p>
<p>It started as a series of shell scripts and ansible playbooks, choosing the
simplest and fastest way to bring a test infrastructure for the upstream
charts.</p>
<p>However, the mechanism of deployment was very flexible from day one, to allow
developers to test independently their changes. It would allow them to, like any
user/customer would, override specific parts of the deployment.</p>
</div>
<div class="section" id="project-goals">
<h2>Project goals<a class="headerlink" href="#project-goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Simplicity</p></li>
<li><p>Be stable</p></li>
<li><p>Use latest stable products from SUSE</p></li>
<li><p>Carry the strict minimum amount of code to support upstream work on SUSE products.</p></li>
<li><p>Be packagable/installable offline</p></li>
<li><p>Leverage upstream first</p></li>
</ul>
</div>
<div class="section" id="design-considerations">
<h2>Design considerations<a class="headerlink" href="#design-considerations" title="Permalink to this headline">¶</a></h2>
<p>In order to not pollute the developer/CI machine (called <cite>localhost</cite>),
all the data relevant for a deployment (like any eventual override) is stored
in a user-space ~/socok8s-workspace folder, with unprivileged access.</p>
<p>This also helps the story of running behind
a corporate firewall: the <cite>localhost</cite> can be (connecting to)
a bastion host with the “deployment” actions happening behind the firewall.</p>
</div>
<div class="section" id="why">
<h2>Why…<a class="headerlink" href="#why" title="Permalink to this headline">¶</a></h2>
<dl>
<dt>… Ansible?</dt><dd><p>Using Ansible is more robust than having written socok8s fully on shell
scripts. It’s ecosystem allows a nice interface to track deployment
progress with ARA, run in a CI/CD like Zuul or Tower/AWX.</p>
</dd>
<dt>… OpenStack on top of Kubernetes on top of OpenStack by default in <cite>run.sh</cite>?</dt><dd><p>We have a cloud for our Engineers, and that cloud is used for CI.
From that point, creating a node for testing is as simple as doing an API
call, and creating a stack of nodes is simple as re-using an existing heat
stack code.</p>
<p>As you might have read in the <a class="reference internal" href="#projecthistory"><span class="std std-ref">Project history</span></a>, <cite>run.sh</cite> was mainly
used for developers and CI. This is why the <cite>run.sh</cite> still points to
<cite>openstack</cite> as default <cite>DEPLOYMENT_MECHANISM</cite>.</p>
</dd>
<dt>… OpenStack on top of Kubernetes?</dt><dd><p>Long story short: Robustness.</p>
</dd>
<dt>… Splitting <cite>run.sh</cite> in so many steps?</dt><dd><p>The current interface of <cite>run.sh</cite> is flexible enough to work for many
different cases, and is semantically close to the actions that will happen
to deploy OpenStack. <cite>run.sh</cite> itself is just an interface, behind the
scenes, it runs a <cite>DEPLOYMENT_MECHANISM</cite> dependant script starting the
appropriate ansible playbooks for the step called.</p>
</dd>
<dt>… A shell script for this interface?</dt><dd><p>It was easier to start with a shell script than writing a CLI in &lt;insert
language here&gt;, mostly because the shell script grew out of usage and
CI needs.</p>
</dd>
<dt>… Installing from sources?</dt><dd><p>Neither the socok8s repo nor the OpenStack-Helm project’s repositories
have been packaged for Leap/SLE 15, yet.</p>
</dd>
</dl>
</div>
<div class="section" id="image-building-process">
<h2>Image building process<a class="headerlink" href="#image-building-process" title="Permalink to this headline">¶</a></h2>
<div class="section" id="upstream-process">
<h3>Upstream process<a class="headerlink" href="#upstream-process" title="Permalink to this headline">¶</a></h3>
<p>The OpenStack-Helm project tries to be agnostic of the images by
providing the ability for deployers to override any image used in the
charts.</p>
<p>However, the OpenStack-Helm project has a repository, <cite>openstack-helm-images</cite>,
containing a reference implementation for the images. That repository
holds the images used for the OpenStack-Helm project charts. All its images
are built with Docker.</p>
<p><cite>openstack-helm-images</cite> provides Dockerfiles directly for all the
non-OpenStack images.</p>
<p>For the OpenStack images, <cite>openstack-helm-images</cite> contains shell scripts,
situated in <cite>openstack/loci/</cite>. The <cite>build.sh</cite> script is a thin wrapper around
<cite>LOCI</cite>. <cite>LOCI</cite> is the official OpenStack project to build lightweight Open
Container Initiative (OCI) compliant images of OpenStack projects. It uses
<cite>docker build</cite> to construct images from OpenStack sources. Their requirements
are expressed in <cite>bindep</cite> files (<cite>bindep.txt</cite> for rpm/apt packages, <cite>pydep.txt</cite>
for python packages). The <cite>build.sh</cite> script runs <cite>LOCI</cite> for the master branch.
Other branches can be built using <cite>build-{branchname}.sh</cite> where <cite>branchname</cite> is
the name of the OpenStack release (for example, <cite>rocky</cite>). See also <a class="reference internal" href="user/build-images.html#buildlociimages"><span class="std std-ref">Build LOCI images</span></a>.</p>
<p>In the future, <cite>openstack-helm-images</cite> could theoretically add images for
OpenStack that would be based on packages by simply providing the appropriate
Dockerfiles.</p>
<p>Additionally, some images are not built in <cite>openstack-helm-images</cite>, and they
are directly consumed/fetched from upstream projects official dockerfiles,
like xrally.</p>
</div>
<div class="section" id="socok8s-process">
<h3>socok8s process<a class="headerlink" href="#socok8s-process" title="Permalink to this headline">¶</a></h3>
<p>socok8s leverages the existing OSH-images code.</p>
<p>When running the <cite>build_images</cite> step, the <cite>localhost</cite> asks the <cite>deployer</cite> to
build images based on the code that was checked in on the <cite>deployer</cite> node
using the <cite>vars/manifest.yml</cite>.</p>
<p>For the non-LOCI images, the <cite>suse-build-images</cite> role invoked in the
<cite>build_images</cite> step is simply running a <cite>docker build</cite> command.</p>
<p>For the LOCI images, the <cite>suse-build-images</cite> role simply runs the command
available in <cite>openstack-helm-images</cite> calling the LOCI build.</p>
</div>
</div>
<div class="section" id="openstack-helm-chart-overrides">
<h2>OpenStack-Helm chart overrides<a class="headerlink" href="#openstack-helm-chart-overrides" title="Permalink to this headline">¶</a></h2>
<div class="section" id="helm-chart-values-overriding-principle">
<h3>Helm chart values overriding principle<a class="headerlink" href="#helm-chart-values-overriding-principle" title="Permalink to this headline">¶</a></h3>
<p>A Helm chart installation
(See <a class="reference external" href="https://helm.sh/docs/using_helm/#customizing-the-chart-before-installing">https://helm.sh/docs/using_helm/#customizing-the-chart-before-installing</a> )
accepts an argument named <code class="docutils literal notranslate"><span class="pre">--values</span></code> or <code class="docutils literal notranslate"><span class="pre">-f</span></code>.</p>
<p>This argument expects the filename of a YAML file present on the
Helm client machine. It can be specified multiple times, and
the rightmost file will take precedence.</p>
<p>For example, in the following example, the different values of
<code class="docutils literal notranslate"><span class="pre">socok8s-glance.yaml</span></code> overrides would win over the existing values in
<code class="docutils literal notranslate"><span class="pre">/tmp/glance.yaml</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">helm upgrade --install glance ./glance --namespace=openstack \</span>
<span class="go">  --values=/tmp/glance.yaml --values=/tmp/socok8s-glance.yaml</span>
</pre></div>
</div>
</div>
<div class="section" id="openstack-helm-scripts">
<h3>OpenStack-Helm scripts<a class="headerlink" href="#openstack-helm-scripts" title="Permalink to this headline">¶</a></h3>
<p>The OpenStack-Helm project provides shell scripts to deploy the Helm charts,
with overrides per context (for example, multinode).</p>
<p>Those shell scripts calling the Helm installation include an environment
variable, to allow users to pass extra arguments.</p>
<p>See for example <a class="reference external" href="https://github.com/openstack/openstack-helm/blob/c869b4ef4a0e95272155c5d5dd893c72976753cd/tools/deployment/multinode/100-glance.sh#L49">https://github.com/openstack/openstack-helm/blob/c869b4ef4a0e95272155c5d5dd893c72976753cd/tools/deployment/multinode/100-glance.sh#L49</a> .</p>
</div>
<div class="section" id="suse-ification-of-the-osh-charts-when-deploying-in-osh-only-mode">
<h3>SUSE-ification of the OSH charts when deploying in OSH only mode<a class="headerlink" href="#suse-ification-of-the-osh-charts-when-deploying-in-osh-only-mode" title="Permalink to this headline">¶</a></h3>
<p>socok8s uses the previously explained environment variable to pass an extra
values file, a “SUSE”ified YAML. All the SUSEified files are present in
<cite>playbooks/roles/deploy-osh/templates/</cite>, for example <cite>socok8s-glance.yml</cite>,
<strong>if they are not part of upstream yet</strong>.</p>
</div>
<div class="section" id="how-deployers-can-extend-a-suseified-osh-chart-in-osh-only-mode">
<h3>How deployers can extend a SUSEified OSH chart in OSH only mode<a class="headerlink" href="#how-deployers-can-extend-a-suseified-osh-chart-in-osh-only-mode" title="Permalink to this headline">¶</a></h3>
<p>Deployers/customers to pass their own YAML overrides, in
user space (for example by using <cite>extravars</cite>), to extend the Helm chart
behavior beyond the “SUSE”ification.</p>
<p>To find those overrides, a user can look into
<cite>playbooks/roles/deploy-osh/defaults/main.yml</cite>.</p>
</div>
<div class="section" id="suse-ification-of-the-osh-charts-when-deploying-with-airship">
<h3>SUSE-ification of the OSH charts when deploying with Airship<a class="headerlink" href="#suse-ification-of-the-osh-charts-when-deploying-with-airship" title="Permalink to this headline">¶</a></h3>
<p>…</p>
</div>
<div class="section" id="how-deployers-can-extend-a-suseified-osh-chart-with-airship">
<h3>How deployers can extend a SUSEified OSH chart with Airship<a class="headerlink" href="#how-deployers-can-extend-a-suseified-osh-chart-with-airship" title="Permalink to this headline">¶</a></h3>
<p>…</p>
</div>
</div>
<div class="section" id="summary-deploy-on-openstack-diagrams">
<h2>Summary “deploy on OpenStack” diagrams<a class="headerlink" href="#summary-deploy-on-openstack-diagrams" title="Permalink to this headline">¶</a></h2>
<div class="section" id="simplified-network-diagram">
<h3>Simplified network diagram<a class="headerlink" href="#simplified-network-diagram" title="Permalink to this headline">¶</a></h3>
<div><img height="732" src="_images/nwdiag-46e2fa062e803217291afd0fadf7fae700b73d9f.png" width="912" /></div></div>
<div class="section" id="osh-deploy-on-openstack-process">
<h3>OSH deploy on OpenStack process<a class="headerlink" href="#osh-deploy-on-openstack-process" title="Permalink to this headline">¶</a></h3>
<div class="section" id="setup-hosts">
<h4>Setup hosts<a class="headerlink" href="#setup-hosts" title="Permalink to this headline">¶</a></h4>
<p>This is the sequence of steps that generates, in OpenStack, the environment
for deploying OSH later.</p>
<div><img height="859" src="_images/seqdiag-d557a248fcc1d7c5ccf2796a81f025c086272996.png" width="1024" /></div></div>
<div class="section" id="setup-openstack">
<h4>Setup OpenStack<a class="headerlink" href="#setup-openstack" title="Permalink to this headline">¶</a></h4>
<p>This is the sequence of steps that ends up with your OpenStack-Helm deployment.
The solid lines represent Ansible plays and their connections.</p>
<p>The dotted lines represent extra connections happening on the Ansible targets.</p>
<div><img height="1678" src="_images/seqdiag-b1f5163652012fa0be9dfdb598432e9194248852.png" width="640" /></div></div>
</div>
</div>
<div class="section" id="environment-variables">
<span id="envvars"></span><h2>Environment variables<a class="headerlink" href="#environment-variables" title="Permalink to this headline">¶</a></h2>
<div class="section" id="in-socok8s">
<h3>In socok8s<a class="headerlink" href="#in-socok8s" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">run.sh</span></code> behaviour can be modified with environment variables.</p>
<p><code class="docutils literal notranslate"><span class="pre">DEPLOYMENT_MECHANISM</span></code> contains the target destination of the deploy
tooling. Currently set to <code class="docutils literal notranslate"><span class="pre">openstack</span></code> by default, but will later
include a <code class="docutils literal notranslate"><span class="pre">baremetal</span></code> and <code class="docutils literal notranslate"><span class="pre">kvm</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">SOCOK8S_DEVELOPER_MODE</span></code> determines if you want to enter developer mode or
not. This adds a step for patching upstream code, builds images and then
continues the deployment.</p>
<p><code class="docutils literal notranslate"><span class="pre">USE_ARA</span></code> determines if you want to store records in ARA. Set its
value to ‘True’ for using ARA.</p>
</div>
<div class="section" id="ansible-environment-variables">
<h3>Ansible environment variables<a class="headerlink" href="#ansible-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>You can use Ansible environment variables to alter Ansible behaviour, for
example by being more verbose.</p>
</div>
<div class="section" id="openstack-helm-environment-variables">
<h3>OpenStack-Helm environment variables<a class="headerlink" href="#openstack-helm-environment-variables" title="Permalink to this headline">¶</a></h3>
<p>OpenStack Helm deployment scripts accepts environment variables to alter their
behaviour. Read each of the scripts to know more about their override
mechanisms.</p>
</div>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="contributor.html" title="Previous document">Developer Documentation</a>
        </li>
        <li>
          <a href="glossary.html" title="Next document">Glossary</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/suse_logo_w-tag_color.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">socok8s</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=SUSE-Cloud&repo=socok8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deployment/index.html">Deployment Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="operations.html">Administration and Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user/index.html">Advanced Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributor.html">Developer Documentation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#project-history">Project history</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-goals">Project goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design-considerations">Design considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#why">Why…</a></li>
<li class="toctree-l2"><a class="reference internal" href="#image-building-process">Image building process</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#upstream-process">Upstream process</a></li>
<li class="toctree-l3"><a class="reference internal" href="#socok8s-process">socok8s process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#openstack-helm-chart-overrides">OpenStack-Helm chart overrides</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#helm-chart-values-overriding-principle">Helm chart values overriding principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openstack-helm-scripts">OpenStack-Helm scripts</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suse-ification-of-the-osh-charts-when-deploying-in-osh-only-mode">SUSE-ification of the OSH charts when deploying in OSH only mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-deployers-can-extend-a-suseified-osh-chart-in-osh-only-mode">How deployers can extend a SUSEified OSH chart in OSH only mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#suse-ification-of-the-osh-charts-when-deploying-with-airship">SUSE-ification of the OSH charts when deploying with Airship</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-deployers-can-extend-a-suseified-osh-chart-with-airship">How deployers can extend a SUSEified OSH chart with Airship</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#summary-deploy-on-openstack-diagrams">Summary “deploy on OpenStack” diagrams</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#simplified-network-diagram">Simplified network diagram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#osh-deploy-on-openstack-process">OSH deploy on OpenStack process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setup-hosts">Setup hosts</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setup-openstack">Setup OpenStack</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#environment-variables">Environment variables</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#in-socok8s">In socok8s</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ansible-environment-variables">Ansible environment variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#openstack-helm-environment-variables">OpenStack-Helm environment variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="contributor.html" title="previous chapter">Developer Documentation</a></li>
      <li>Next: <a href="glossary.html" title="next chapter">Glossary</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SUSE.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/reference.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/SUSE-Cloud/socok8s" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>