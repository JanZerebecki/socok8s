
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Configure Cloud &#8212; socok8s  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Deploy Airship and OpenStack" href="deploy.html" />
    <link rel="prev" title="SUSE Enterprise Storage Integration" href="ses-integration.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="ses-integration.html" title="Previous document">SUSE Enterprise Storage Integration</a>
        </li>
        <li>
          <a href="deploy.html" title="Next document">Deploy Airship and OpenStack</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <div class="section" id="configure-cloud">
<span id="configuredeployment"></span><h1>Configure Cloud<a class="headerlink" href="#configure-cloud" title="Permalink to this headline">¶</a></h1>
<div><img height="200" src="../_images/blockdiag-2eebefe7e4d4988a217a0e4e8324ca8919f09985.png" width="1216" /></div><p>This <a class="reference internal" href="../glossary.html#term-workspace"><span class="xref std std-term">workspace</span></a>, structured like an <cite>ansible-runner</cite> directory,
contains the following deployment artifacts:</p>
<div class="line-block">
<div class="line">socok8s-workspace</div>
<div class="line">├── inventory</div>
<div class="line">│   └── hosts.yml</div>
<div class="line">├── env</div>
<div class="line">│   └── extravar</div>
<div class="line">├── ses_config.yml</div>
<div class="line">└── kubeconfig</div>
</div>
<div class="section" id="configure-the-inventory">
<h2>Configure the Inventory<a class="headerlink" href="#configure-the-inventory" title="Permalink to this headline">¶</a></h2>
<p>You can create an inventory based on the hosts.yml file in the <cite>examples</cite>
folder.  (<em>examples/workdir/inventory/hosts.yml</em>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">caasp</span><span class="o">-</span><span class="n">admin</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">caasp</span><span class="o">-</span><span class="n">masters</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">caasp</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">soc</span><span class="o">-</span><span class="n">deployer</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">ses_nodes</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">airship</span><span class="o">-</span><span class="n">openstack</span><span class="o">-</span><span class="n">compute</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">airship</span><span class="o">-</span><span class="n">openstack</span><span class="o">-</span><span class="n">control</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">airship</span><span class="o">-</span><span class="n">ucp</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>

<span class="n">airship</span><span class="o">-</span><span class="n">kube</span><span class="o">-</span><span class="n">system</span><span class="o">-</span><span class="n">workers</span><span class="p">:</span>
  <span class="nb">vars</span><span class="p">:</span>
    <span class="n">ansible_user</span><span class="p">:</span> <span class="n">root</span>
</pre></div>
</div>
<p>For each group, a <cite>hosts:</cite> key should be added for each of the hosts you are
using. For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">airship-openstack-control-workers</span><span class="p">:</span>
  <span class="nt">hosts</span><span class="p">:</span>
    <span class="nt">caasp-worker-001</span><span class="p">:</span>
      <span class="nt">ansible_host</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10.86.1.144</span>
</pre></div>
</div>
<p>The group <cite>airship-ucp-workers</cite> specifies the list of CaaS Platform worker
nodes to which the Airship Under Cloud Platform (UCP) services will be
deployed. The UCP services in socok8s include Armada, Shipyard, Deckhand,
Pegleg, Keystone, Barbican, and core infrastructure services such as
MariaDB, RabbitMQ, and PostgreSQL.</p>
<p>The group <cite>airship-openstack-control-workers</cite> specifies the list of CaaS
Platform worker nodes that make up the Openstack control plane. The
Openstack control plane includes Keystone, Glance, Cinder, Nova, Neutron,
Horizon, Heat, MariaDB, RabbitMQ and so on.</p>
<p>The group <cite>airship-openstack-compute-workers</cite> defines the CaaS Platform worker
nodes used as Openstack Compute Nodes. Nova Compute, Libvirt, Open vSwitch are
deployed to these nodes.</p>
<p>For most users, UCP and Openstack control planes can share the same worker
nodes. The Openstack Compute Nodes should be dedicated worker nodes unless
a light workload is expected.</p>
<p>See also
<a class="reference external" href="https://docs.ansible.com/ansible/2.7/user_guide/intro_inventory.html#hosts-and-groups">Ansible Inventory Hosts and Groups</a>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Do not add <cite>localhost</cite> as a host in your inventory.
It is a host specially considered by Ansible.
If you want to create an inventory node for your local
machine, add your machine’s hostname inside your inventory,
and specify this host variable: <strong>ansible_connection: local</strong></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If Deployer is running as a non-root user, replace ansible_user: value for
the soc-deployer entry with your logged in user.</p>
</div>
</div>
<div class="section" id="configure-for-ses-integration">
<h2>Configure for SES Integration<a class="headerlink" href="#configure-for-ses-integration" title="Permalink to this headline">¶</a></h2>
<p>The file <cite>ses_config.yml</cite> is the output from :ref: <cite>ses_integration</cite>, and must
be present in the workspace.</p>
<p>The Ceph admin keyring and user keyring, in <strong>base64</strong>, must be present in the
file <cite>env/extravars</cite> in your workspace.</p>
<p>The Ceph admin keyring can be obtained by running the following on ceph host.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">sudo ceph auth get-key client.admin | base64</span>
</pre></div>
</div>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">ceph_admin_keyring_b64key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">QVFDMXZ6dGNBQUFBQUJBQVJKakhuYkY4VFpublRPL1RXUEROdHc9PQo=</span>
<span class="nt">ceph_user_keyring_b64key</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">QVFDMXZ6dGNBQUFBQUJBQVJKakhuYkY4VFpublRPL1RXUEROdHc9PQo=</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-for-kubernetes">
<h2>Configure for Kubernetes<a class="headerlink" href="#configure-for-kubernetes" title="Permalink to this headline">¶</a></h2>
<p>socok8s relies on kubectl and Helm commands to configure your OpenStack
deployment. You need to provide a <cite>kubeconfig</cite> file on the <cite>deployer</cite> node,
in your workspace. You can fetch this file from the Velum UI on your
SUSE CaaS Platform cluster.</p>
</div>
<div class="section" id="configure-the-vip-that-will-be-used-for-openstack-service-public-endpoints">
<h2>Configure the VIP that will be used for OpenStack service public endpoints<a class="headerlink" href="#configure-the-vip-that-will-be-used-for-openstack-service-public-endpoints" title="Permalink to this headline">¶</a></h2>
<p>Add <cite>socok8s_ext_vip:</cite> with its appropriate value for your
environment in your <cite>env/extravars</cite>. This should be an available IP
on the external network (in a development environment, it can be the same as
CaaSP cluster network).</p>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">socok8s_ext_vip</span><span class="p">:</span> <span class="s">&quot;10.10.10.10&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-the-vip-that-will-be-used-for-airship-ucp-service-endpoints">
<h2>Configure the VIP that will be used for Airship UCP service endpoints<a class="headerlink" href="#configure-the-vip-that-will-be-used-for-airship-ucp-service-endpoints" title="Permalink to this headline">¶</a></h2>
<p>Add <cite>socok8s_dcm_vip:</cite> with its appropriate value for your
environment in your <cite>env/extravars</cite>. This should be an available IP
on the Data Center Management (DCM) network (in development environment, it
can be the same as CaaSP cluster network).</p>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">socok8s_dcm_vip</span><span class="p">:</span> <span class="s">&quot;192.168.51.35&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="configure-cloud-scale-profile">
<h2>Configure Cloud Scale Profile<a class="headerlink" href="#configure-cloud-scale-profile" title="Permalink to this headline">¶</a></h2>
<p>The pod scale profile in socok8s allows you to specify the desired number of
pods that each Airship and Openstack service should run.</p>
<p>There are two built-in scale profiles: <cite>minimal</cite> and <cite>ha</cite>. <cite>minimal</cite> will
deploy exactly one pod for each service, making it suitable for demo or trial
on a resource-limited system. <cite>ha</cite> (High Availability) ensures at least two
instances of pods for all services, and three or more pods for services that
require quorum and are more heavily used.</p>
<p>To specify the scale profile to use, add <cite>scale_profile:</cite> in the
<cite>env/extravars</cite>.</p>
<p>For example:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">scale_profile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">ha</span>
</pre></div>
</div>
<p>The definitions of the pod scale profile can be found in this repository:
playbooks/roles/airship-deploy-ucp/files/profiles.</p>
<p>You can customize the built-in profile or create your own profile following
the file name convention.</p>
</div>
<div class="section" id="advanced-configuration">
<h2>Advanced Configuration<a class="headerlink" href="#advanced-configuration" title="Permalink to this headline">¶</a></h2>
<p>socok8s deployment variables respects Ansible general precedence.
Therefore all the variables can be adapted.</p>
<p>You can override most user-facing variables with host vars and
group vars.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also use extravars, as they always win.
extravars can be used to override any deployment code.
Use it at your own risk.</p>
</div>
<p>socok8s is flexible, and allows you to override the value of any upstream Helm
chart value with the appropriate overrides.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please read the page <a class="reference internal" href="../user/index.html#userscenarios"><span class="std std-ref">Advanced Users</span></a> for inspiration on overrides.</p>
</div>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="ses-integration.html" title="Previous document">SUSE Enterprise Storage Integration</a>
        </li>
        <li>
          <a href="deploy.html" title="Next document">Deploy Airship and OpenStack</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/suse_logo_w-tag_color.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="../index.html">socok8s</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=SUSE-Cloud&repo=socok8s&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Deployment Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Installation Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="requirements.html">System Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup-deployer.html">Set Up Deployer</a></li>
<li class="toctree-l2"><a class="reference internal" href="ses-integration.html">SUSE Enterprise Storage Integration</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Configure Cloud</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-inventory">Configure the Inventory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-for-ses-integration">Configure for SES Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-for-kubernetes">Configure for Kubernetes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-vip-that-will-be-used-for-openstack-service-public-endpoints">Configure the VIP that will be used for OpenStack service public endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-vip-that-will-be-used-for-airship-ucp-service-endpoints">Configure the VIP that will be used for Airship UCP service endpoints</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-cloud-scale-profile">Configure Cloud Scale Profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#advanced-configuration">Advanced Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="deploy.html">Deploy Airship and OpenStack</a></li>
<li class="toctree-l2"><a class="reference internal" href="verify.html">Verify OpenStack operation</a></li>
<li class="toctree-l2"><a class="reference internal" href="next-steps.html">Next steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../operations.html">Administration and Operations Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user/index.html">Advanced Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributor.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Deployment Guide</a><ul>
      <li>Previous: <a href="ses-integration.html" title="previous chapter">SUSE Enterprise Storage Integration</a></li>
      <li>Next: <a href="deploy.html" title="next chapter">Deploy Airship and OpenStack</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, SUSE.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/deployment/configure.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/SUSE-Cloud/socok8s" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>